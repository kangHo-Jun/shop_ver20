# V8.1 â†’ V10 ì—…ê·¸ë ˆì´ë“œ ê°€ì´ë“œ

## ğŸ“‹ ê°œìš”

V8.1ì—ì„œ V10ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œí•˜ë©´ **ì—¬ëŸ¬ ì»´í“¨í„°ì—ì„œ ë™ì‹œ ì‹¤í–‰** ì‹œ ì¤‘ë³µ ì²˜ë¦¬ë¥¼ ë°©ì§€í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

---

## ğŸ”„ ì—…ê·¸ë ˆì´ë“œ ì ˆì°¨

### 1. ë°±ì—… (ì¤‘ìš”!)

```bash
# í˜„ì¬ ì„¤ì • ë°±ì—…
copy .env .env.v8.backup
copy v8_history.json v8_history.backup.json

# ë˜ëŠ” ì „ì²´ í´ë” ë°±ì—… ê¶Œì¥
xcopy /E /I "c:\Users\DSAI\Desktop\ë§¤ì¥ìë™í™”" "c:\Users\DSAI\Desktop\ë§¤ì¥ìë™í™”_v8_backup"
```

### 2. V10 íŒŒì¼ í™•ì¸

ë‹¤ìŒ íŒŒì¼ë“¤ì´ í”„ë¡œì íŠ¸ í´ë”ì— ìˆëŠ”ì§€ í™•ì¸:

- âœ… `lock_manager.py` (ì‹ ê·œ)
- âœ… `v10_auto_server.py` (ì‹ ê·œ)
- âœ… `erp_upload_automation_v2.py` (v1 ë³µì‚¬ë³¸)
- âœ… `run_v10_server.bat` (ì‹ ê·œ)
- âœ… `.env.v10.example` (ì‹ ê·œ)
- âœ… `V10_README.md` (ì‹ ê·œ)
- âœ… `test_v10_lock.py` (ì‹ ê·œ)
- âœ… `config.py` (V10 ì„¤ì • ì¶”ê°€ë¨)

### 3. í™˜ê²½ ì„¤ì • ì—…ë°ì´íŠ¸

#### ë°©ë²• A: ê¸°ì¡´ .env ìˆ˜ì •

```bash
# .env íŒŒì¼ ì—´ê¸°
notepad .env

# ë‹¤ìŒ ë‚´ìš© ì¶”ê°€:
ENABLE_DISTRIBUTED_LOCK=true
LOCK_TIMEOUT_SEC=1800
LOCK_SHEET_NAME=processing_lock
HISTORY_FILE=v10_history.json
```

#### ë°©ë²• B: ìƒˆë¡œ ì‘ì„±

```bash
# ì˜ˆì œ íŒŒì¼ ë³µì‚¬
copy .env.v10.example .env

# .env íŒŒì¼ í¸ì§‘í•˜ì—¬ ì‹¤ì œ ê°’ ì…ë ¥
notepad .env
```

**í•„ìˆ˜ ì„¤ì • í•­ëª©**:
- `ECOUNT_COMPANY_CODE` - íšŒì‚¬ ì½”ë“œ
- `ECOUNT_ID` - ê³„ì • ID
- `ECOUNT_PASSWORD` - ë¹„ë°€ë²ˆí˜¸
- `GS_SPREADSHEET_ID` - Google Sheets ID

### 4. Google Sheets ì„¤ì •

#### 4-1. ë½ ì‹œíŠ¸ ìë™ ìƒì„± (ê¶Œì¥)

V10 ì„œë²„ë¥¼ ì²˜ìŒ ì‹¤í–‰í•˜ë©´ ìë™ìœ¼ë¡œ `processing_lock` ì‹œíŠ¸ê°€ ìƒì„±ë©ë‹ˆë‹¤.

```bash
run_v10_server.bat
```

ì²« ì‹¤í–‰ ì‹œ Google OAuth ì¸ì¦ ì°½ì´ ëœ¹ë‹ˆë‹¤:
1. Google ê³„ì • ì„ íƒ
2. ê¶Œí•œ í—ˆìš©
3. ì¸ì¦ ì™„ë£Œ í›„ ì„œë²„ ìë™ ì‹œì‘

#### 4-2. ìˆ˜ë™ ìƒì„± (ì„ íƒ)

Google Sheetsì—ì„œ ì§ì ‘ ìƒì„±í•˜ë ¤ë©´:

1. Google Sheets ì—´ê¸° (GS_SPREADSHEET_ID)
2. ìƒˆ ì‹œíŠ¸ ì¶”ê°€: `processing_lock`
3. ì²« í–‰ì— í—¤ë” ì…ë ¥:
   ```
   order_id | locked_by | locked_at | status | machine_id | notes
   ```

### 5. í…ŒìŠ¤íŠ¸ ì‹¤í–‰

ë¶„ì‚° ë½ ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™í•˜ëŠ”ì§€ í™•ì¸:

```bash
# ê°€ìƒí™˜ê²½ í™œì„±í™”
.venv\Scripts\activate

# í…ŒìŠ¤íŠ¸ ì‹¤í–‰
python test_v10_lock.py
```

**ì˜ˆìƒ ê²°ê³¼**:
```
ì´ 9/9 í…ŒìŠ¤íŠ¸ í†µê³¼ (100.0%)
ğŸ‰ ëª¨ë“  í…ŒìŠ¤íŠ¸ í†µê³¼! V10 ë¶„ì‚° ë½ ì‹œìŠ¤í…œì´ ì •ìƒ ì‘ë™í•©ë‹ˆë‹¤.
```

### 6. V10 ì„œë²„ ì‹¤í–‰

```bash
run_v10_server.bat
```

**ë˜ëŠ”**:
```bash
.venv\Scripts\activate
python v10_auto_server.py
```

### 7. ì›¹ ëŒ€ì‹œë³´ë“œ í™•ì¸

ë¸Œë¼ìš°ì €ì—ì„œ ì ‘ì†:
```
http://localhost:5080
```

**í™•ì¸ í•­ëª©**:
- âœ… "Distributed Lock Manager" ì¹´ë“œì— "âœ… Connected" í‘œì‹œ
- âœ… Machine ID í‘œì‹œë¨
- âœ… Auto Downloader ì‘ë™ ì¤‘

---

## ğŸ”€ V8.1ê³¼ V10 ë³‘í–‰ ì‹¤í–‰

### ì‹œë‚˜ë¦¬ì˜¤: V8.1ì„ ê³„ì† ì‚¬ìš©í•˜ë©´ì„œ V10 í…ŒìŠ¤íŠ¸

#### ì˜µì…˜ 1: ë‹¤ë¥¸ í¬íŠ¸ ì‚¬ìš©

**V8.1**:
```bash
# .env
FLASK_PORT=5080
```

**V10**:
```bash
# .env (ë˜ëŠ” .env.v10)
FLASK_PORT=5090
```

ë‘ ì„œë²„ë¥¼ ë™ì‹œì— ì‹¤í–‰í•  ìˆ˜ ìˆì§€ë§Œ, **ì¤‘ë³µ ì²˜ë¦¬ ì£¼ì˜**!

#### ì˜µì…˜ 2: ë‹¤ë¥¸ íˆìŠ¤í† ë¦¬ íŒŒì¼ ì‚¬ìš©

**V8.1**:
```bash
# v8_auto_server.py ì—ì„œ
HISTORY_FILE = "v8_history.json"
```

**V10**:
```bash
# .env
HISTORY_FILE=v10_history.json
```

---

## ğŸš¨ ì£¼ì˜ì‚¬í•­

### 1. V8.1ê³¼ V10ì„ ê°™ì€ Google Sheetsì—ì„œ ë™ì‹œ ì‹¤í–‰í•˜ì§€ ë§ˆì„¸ìš”

**ë¬¸ì œ**: V8.1ì€ ë¶„ì‚° ë½ì„ ì‚¬ìš©í•˜ì§€ ì•Šìœ¼ë¯€ë¡œ ì¤‘ë³µ ì²˜ë¦¬ ë°œìƒ

**í•´ê²°**:
- âœ… ëª¨ë“  PCë¥¼ V10ìœ¼ë¡œ ì—…ê·¸ë ˆì´ë“œ
- âœ… ë˜ëŠ” V8.1ë§Œ ì‚¬ìš© (ë‹¨ì¼ PC)

### 2. Google Sheets ê¶Œí•œ

V10ì€ **ì½ê¸°/ì“°ê¸°** ê¶Œí•œì´ í•„ìš”í•©ë‹ˆë‹¤:
- `google_oauth_credentials.json`ì˜ ìŠ¤ì½”í”„ í™•ì¸
- `SCOPES = ['https://www.googleapis.com/auth/spreadsheets']` (ì½ê¸°/ì“°ê¸°)

V8.1ì€ ì½ê¸° ì „ìš©ë„ ê°€ëŠ¥í–ˆì§€ë§Œ, V10ì€ ë½ ì‹œíŠ¸ë¥¼ ì—…ë°ì´íŠ¸í•´ì•¼ í•˜ë¯€ë¡œ ì“°ê¸° ê¶Œí•œ í•„ìˆ˜!

### 3. íˆìŠ¤í† ë¦¬ íŒŒì¼ ë§ˆì´ê·¸ë ˆì´ì…˜

```bash
# V8 íˆìŠ¤í† ë¦¬ë¥¼ V10ìœ¼ë¡œ ë³µì‚¬ (ì„ íƒ)
copy v8_history.json v10_history.json
```

**ë˜ëŠ”**: ê¹¨ë—í•˜ê²Œ ì‹œì‘
```bash
# v10_history.jsonì€ ìë™ ìƒì„±ë¨ (ë¹ˆ íŒŒì¼)
```

---

## ğŸ”§ ë¬¸ì œ í•´ê²°

### "Lock manager not connected" ê²½ê³ 

**ì›ì¸**: Google Sheets ì—°ê²° ì‹¤íŒ¨

**í•´ê²°**:
1. `google_oauth_credentials.json` íŒŒì¼ í™•ì¸
2. Google Sheets API í™œì„±í™” í™•ì¸
3. ì¸í„°ë„· ì—°ê²° í™•ì¸
4. í† í° ì¬ìƒì„±:
   ```bash
   del google_token.pickle
   python v10_auto_server.py
   ```

### V10 ì„œë²„ê°€ ì‹œì‘ë˜ì§€ ì•ŠìŒ

**ì²´í¬ë¦¬ìŠ¤íŠ¸**:
- [ ] `.env` íŒŒì¼ ì¡´ì¬ ë° ì„¤ì • í™•ì¸
- [ ] ê°€ìƒí™˜ê²½ í™œì„±í™”ë¨
- [ ] í•„ìˆ˜ íŒ¨í‚¤ì§€ ì„¤ì¹˜:
  ```bash
  pip install -r requirements.txt
  ```
- [ ] Python ë²„ì „ í™•ì¸ (3.10 ì´ìƒ ê¶Œì¥)

### í…ŒìŠ¤íŠ¸ ì‹¤íŒ¨

**TEST 1 (Connection) ì‹¤íŒ¨**:
â†’ Google ì¸ì¦ ë¬¸ì œ. `google_oauth_credentials.json` í™•ì¸

**TEST 3 (Duplicate Prevention) ì‹¤íŒ¨**:
â†’ ë½ ë¡œì§ ë²„ê·¸ ê°€ëŠ¥ì„±. ê°œë°œìì—ê²Œ ë¬¸ì˜

**TEST 5 (Completed Reacquire Prevention) ì‹¤íŒ¨**:
â†’ ìƒíƒœ ì—…ë°ì´íŠ¸ ë¬¸ì œ. Google Sheets ê¶Œí•œ í™•ì¸

---

## ğŸ“Š ì„±ëŠ¥ ë¹„êµ

| í•­ëª© | V8.1 | V10 |
|------|------|-----|
| **ë‹¤ìš´ë¡œë“œ ì†ë„** | âš¡ ë¹ ë¦„ | âš¡ ë¹ ë¦„ (ë™ì¼) |
| **ì—…ë¡œë“œ ì†ë„** | âš¡ ë¹ ë¦„ | âš¡ ë¹ ë¦„ (ë™ì¼) |
| **ë½ ì²´í¬ ì˜¤ë²„í—¤ë“œ** | ì—†ìŒ | ~0.5ì´ˆ/ì£¼ë¬¸ (Google API í˜¸ì¶œ) |
| **ì´ ì²˜ë¦¬ ì‹œê°„** | ê¸°ì¤€ | ê¸°ì¤€ + 5~10% |
| **ì¤‘ë³µ ì²˜ë¦¬** | âŒ ë°œìƒ ê°€ëŠ¥ | âœ… ì™„ë²½ ë°©ì§€ |

**ê¶Œì¥**: ë„¤íŠ¸ì›Œí¬ ì†ë„ê°€ ëŠë¦° í™˜ê²½ì—ì„œëŠ” ë½ íƒ€ì„ì•„ì›ƒ ì¦ê°€:
```bash
LOCK_TIMEOUT_SEC=3600  # 60ë¶„
```

---

## ğŸ¯ ë¡¤ë°± ì ˆì°¨ (V10 â†’ V8.1)

V10ì—ì„œ ë¬¸ì œ ë°œìƒ ì‹œ V8.1ë¡œ ë˜ëŒë¦¬ê¸°:

```bash
# 1. V10 ì„œë²„ ì¤‘ì§€ (Ctrl+C)

# 2. .env ë³µì›
copy .env.v8.backup .env

# 3. V8.1 ì„œë²„ ì‹¤í–‰
run_v8_server.bat
```

---

## âœ… ì—…ê·¸ë ˆì´ë“œ ì²´í¬ë¦¬ìŠ¤íŠ¸

- [ ] V8.1 ë°±ì—… ì™„ë£Œ
- [ ] V10 íŒŒì¼ í™•ì¸
- [ ] `.env` íŒŒì¼ ì—…ë°ì´íŠ¸
- [ ] Google Sheets ë½ ì‹œíŠ¸ ìƒì„± (ìë™/ìˆ˜ë™)
- [ ] í…ŒìŠ¤íŠ¸ ì‹¤í–‰ (test_v10_lock.py)
- [ ] V10 ì„œë²„ ì‹¤í–‰
- [ ] ì›¹ ëŒ€ì‹œë³´ë“œ í™•ì¸
- [ ] ì‹¤ì œ ì£¼ë¬¸ìœ¼ë¡œ í…ŒìŠ¤íŠ¸
- [ ] ë‹¤ë¥¸ PCì—ì„œë„ V10 ì„¤ì¹˜ (ë‹¤ì¤‘ PC í™˜ê²½)

---

## ğŸ“ ì¶”ê°€ ì§€ì›

ì—…ê·¸ë ˆì´ë“œ ì¤‘ ë¬¸ì œ ë°œìƒ ì‹œ:

1. ë¡œê·¸ íŒŒì¼ í™•ì¸:
   ```
   logs/app_YYYYMMDD.json
   logs/critical_errors.json
   ```

2. í…ŒìŠ¤íŠ¸ ê²°ê³¼ ì €ì¥:
   ```bash
   python test_v10_lock.py > test_result.txt
   ```

3. ê°œë°œìì—ê²Œ ì „ë‹¬:
   - `test_result.txt`
   - `logs/app_*.json`
   - `.env` (ë¯¼ê° ì •ë³´ ì œê±° í›„)

---

**Happy Upgrading! ğŸš€**
