# 🛒 영림 발주서 관리 웹 자동화 시스템 개발 과정 기록 (Process Log)

본 문서는 영림 발주서(HTML/MHTML) 데이터를 추출하여 이카운트(Ecount) ERP에 자동으로 업로드하는 시스템의 버전별 발전 과정과 주요 기술적 도전 과제를 기록합니다.

---

## 📅 프로젝트 타임라인 및 버전별 진화

### [Step 1] V1 ~ V3: 기초 자동화 구축 (CLI 기반)
*   **목표**: 로컬에 다운로드된 HTML 파일을 파싱하여 ERP에 데이터 입력.
*   **주요 성과**:
    *   `local_file_processor.py`: 기존 Google Apps Script(GAS)의 복잡한 품목 코드 생성 로직을 Python으로 완벽 이식.
    *   `erp_upload_automation_v1.py`: Playwright를 이용한 이카운트 자동 로그인 및 데이터 입력 구현.
*   **encountered Problems**:
    *   **문제**: MHTML 파일의 특수 인코딩(Quoted-Printable)으로 인해 텍스트가 깨지는 현상.
    *   **해결**: `quopri` 라이브러리를 도입하여 HTML 소스를 정확하게 디코딩하는 전처리 로직 추가.

### [Step 2] V4: 이력 관리 및 안정화
*   **목표**: 중복 업로드 방지 및 실행 상태 기록.
*   **주요 성과**:
    *   `v4_history.json`: 처리된 주문번호(출하번호)를 기록하여 동일한 파일이 중복 업로드되지 않도록 방어 로직 구축.

### [Step 3] V5 ~ V6: 하이브리드 자동화 서버 (Web UI)
*   **목표**: 명령줄(CLI) 대신 웹 브라우저에서 버튼 클릭으로 제어하는 UI 도입.
*   **주요 성과**:
    *   Flask 기반 웹 서버 구축 (포트 5000/5060/5080).
    *   **Auto-Downloader**: 30분 간격으로 영림 사이트를 감시하며 신규 주문을 자동으로 수집하는 백그라운드 스레드 구현.
*   **encountered Problems**:
    *   **문제**: 브라우저 세션 충돌. 사용자가 작업 중인 브라우저와 자동화 브라우저가 충돌함.
    *   **해결**: `avast_automation_profile`이라는 별도의 사용자 데이터 디렉토리를 지정하여 독립된 브라우저 환경 제공.

### [Step 4] V7: 견적서(Estimate) 대응 및 정밀도 향상
*   **목표**: '구매입력' 외에 '견적서입력' 메뉴 지원 및 특정 레이아웃 맞춤화.
*   **주요 성과**:
    *   견적서 전용 22열 데이터 레이아웃(A~V열) 개발.
    *   **물리적 붙여넣기**: JavaScript 방식 대신 `pyperclip`과 `keyboard`를 이용한 실제 `Ctrl+V` 키 입력 방식 도입.
*   **encountered Problems**:
    *   **문제**: 이카운트 팝업의 복잡한 프레임 구조. 일반적인 셀렉터로 '웹자료올리기' 팝업 내부의 입력칸을 찾지 못함.
    *   **해결**: 팝업의 텍스트 기반 매칭(Bounding Box 탐지)을 통해 위치를 계산하고, 물리적으로 클릭 후 붙여넣는 정밀 제어 로직 구현.

### [Step 5] V8: 사용자 편의성 극대화 (최신)
*   **목표**: 불필요한 대기 시간 제거 및 실시간 상태 알림.
*   **주요 성과**:
    *   **로그인 프리(Login-free)**: 기존에 열려있는 브라우저 세션을 그대로 활용하여 로그인 과정 스킵.
    *   **자동 종료**: 붙여넣기 성공 후 즉시 프로그램을 종료하여 사용자가 바로 `F8(저장)`을 누를 수 있도록 최적화.
    *   **상태 대시보드**: 다운로드 및 업로드 진행 상황을 웹 화면에 실시간 로그로 표시.

---

## 🛠 주요 기술 및 해결된 이슈 (Summary)

| 분류 | 이슈 내용 | 해결 방안 |
| :--- | :--- | :--- |
| **코드 생성** | GAS의 복잡한 정규표현식 코드 생성 로직 | Python `re` 모듈을 사용하여 1:1 대응 함수 구현 및 검증 |
| **브라우저 제어** | Selenium과 Playwright의 혼용 이슈 | 목적에 따라 스크래핑(Selenium), 업로드(Playwright)로 역할 분담 및 CDP 연결 공유 |
| **데이터 입력** | 이카운트 입력창의 JavaScript 입력 차단 | `pyperclip`을 통한 클립보드 복사 + `Control+v` 키보드 시뮬레이션 |
| **파일 파싱** | 다양한 형태의 HTML 테이블 구조 | `BeautifulSoup4`를 이용한 유연한 로직 및 키워드 기반 회사 자동 감지 |
| **속도 제한** | 대량 데이터 업로드 시 브라우저 멈춤 | 10건씩 제한하던 로직을 해제하고 전체 일괄 업로드 성능 최적화 |

---

## 🚀 향후 과제
1.  **에러 복구 자동화**: 네트워크 단절 시 브라우저 자동 재시작 및 락(Lock) 해제 로직 강화.
2.  **클라우드 연동**: 로컬 PC가 아닌 서버 환경에서의 구동 테스트.
3.  **UI 고도화**: 더 시각적으로 화려한 대시보드(진행 바 등) 추가.

---
**작성일**: 2025-12-24
**작성자**: Antigravity (Pair Programming with User)
